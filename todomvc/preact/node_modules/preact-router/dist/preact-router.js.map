{"version":3,"file":"preact-router.js","sources":["../src/util.js","../src/index.js"],"sourcesContent":["\nconst EMPTY = {};\n\nexport function exec(url, route, opts=EMPTY) {\n\tlet reg = /(?:\\?([^#]*))?(#.*)?$/,\n\t\tc = url.match(reg),\n\t\tmatches = {},\n\t\tret;\n\tif (c && c[1]) {\n\t\tlet p = c[1].split('&');\n\t\tfor (let i=0; i<p.length; i++) {\n\t\t\tlet r = p[i].split('=');\n\t\t\tmatches[decodeURIComponent(r[0])] = decodeURIComponent(r.slice(1).join('='));\n\t\t}\n\t}\n\turl = segmentize(url.replace(reg, ''));\n\troute = segmentize(route || '');\n\tlet max = Math.max(url.length, route.length);\n\tfor (let i=0; i<max; i++) {\n\t\tif (route[i] && route[i].charAt(0)===':') {\n\t\t\tmatches[route[i].substring(1)] = decodeURIComponent(url[i] || '');\n\t\t}\n\t\telse {\n\t\t\tif (route[i]!==url[i]) {\n\t\t\t\tret = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tif (opts.default!==true && ret===false) return false;\n\treturn matches;\n}\n\nexport function pathRankSort(a, b) {\n\tlet aAttr = a.attributes || EMPTY,\n\t\tbAttr = b.attributes || EMPTY;\n\tif (aAttr.default) return 1;\n\tif (bAttr.default) return -1;\n\tlet diff = rank(aAttr.path) - rank(bAttr.path);\n\treturn diff || (aAttr.path.length - bAttr.path.length);\n}\n\nexport function segmentize(url) {\n\treturn strip(url).split('/');\n}\n\nexport function rank(url) {\n\treturn (strip(url).match(/\\/+/g) || '').length;\n}\n\nexport function strip(url) {\n\treturn url.replace(/(^\\/+|\\/+$)/g, '');\n}\n","import { h, Component } from 'preact';\nimport { exec, pathRankSort } from './util';\n\nconst routers = [];\n\nconst EMPTY = {};\n\nfunction route(url, replace=false) {\n\tif (typeof url!=='string' && url.url) {\n\t\treplace = url.replace;\n\t\turl = url.url;\n\t}\n\tif (history) {\n\t\tif (replace===true) {\n\t\t\thistory.replaceState(null, null, url);\n\t\t}\n\t\telse {\n\t\t\thistory.pushState(null, null, url);\n\t\t}\n\t}\n\trouteTo(url);\n}\n\nfunction routeTo(url) {\n\trouters.forEach( router => router.routeTo(url) );\n}\n\nfunction getCurrentUrl() {\n\tlet url = typeof location!=='undefined' ? location : EMPTY;\n\treturn `${url.pathname || ''}${url.search || ''}`;\n}\n\nif (typeof addEventListener==='function') {\n\taddEventListener('popstate', () => routeTo(getCurrentUrl()));\n}\n\n\nfunction handleLinkClick(e) {\n\troute(this.getAttribute('href'));\n\tif (e.stopImmediatePropagation) e.stopImmediatePropagation();\n\te.stopPropagation();\n\te.preventDefault();\n\treturn false;\n}\n\n\nconst Link = ({ children, ...props }) => (\n\t<a {...props} onClick={ handleLinkClick }>{ children }</a>\n);\n\n\nclass Router extends Component {\n\tgetInitialState() {\n\t\treturn { url: getCurrentUrl() };\n\t}\n\n\trouteTo(url) {\n\t\tthis.setState({ url });\n\t}\n\n\tcomponentWillMount() {\n\t\trouters.push(this);\n\t}\n\n\tcomponentWillUnmount() {\n\t\trouters.splice(routers.indexOf(this), 1);\n\t}\n\n\trender({ children, onChange }, { url }) {\n\t\tlet active = children.slice().sort(pathRankSort).filter( ({ attributes }) => {\n\t\t\tlet path = attributes.path,\n\t\t\t\tmatches = exec(url, path, attributes);\n\t\t\tif (matches) {\n\t\t\t\tattributes.url = url;\n\t\t\t\tattributes.matches = matches;\n\t\t\t\t// copy matches onto props\n\t\t\t\tfor (let i in matches) {\n\t\t\t\t\tif (matches.hasOwnProperty(i)) {\n\t\t\t\t\t\tattributes[i] = matches[i];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\t\tlet previous = this.previousUrl;\n\t\tif (url!==previous) {\n\t\t\tthis.previousUrl = url;\n\t\t\tif (typeof onChange==='function') {\n\t\t\t\tonChange({\n\t\t\t\t\trouter: this,\n\t\t\t\t\turl,\n\t\t\t\t\tprevious,\n\t\t\t\t\tactive,\n\t\t\t\t\tcurrent: active[0]\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn active[0] || null;\n\t}\n}\n\n\nconst Route = ({ component:RoutedComponent, url, matches }) => (\n\t<RoutedComponent {...{url, matches}} />\n);\n\n\nRouter.route = route;\nRouter.Router = Router;\nRouter.Route = Route;\nRouter.Link = Link;\n\nexport default Router;\n"],"names":["EMPTY","h","Component"],"mappings":"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"}